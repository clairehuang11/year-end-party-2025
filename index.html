<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DISCO FEVER｜尾牙座位查詢</title>
<style>
:root{--cyan:#35e6ff;--magenta:#ff3df2;--yellow:#ffe34f;--text:#eaf1ff;--muted:rgba(234,241,255,.72);--glass:rgba(8,10,20,.62);--line:rgba(53,230,255,.35);}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", Arial, "PingFang TC","Microsoft JhengHei", sans-serif;
  color:var(--text);
  background: radial-gradient(900px 600px at 50% 30%, rgba(255,61,242,.10), transparent 60%),radial-gradient(900px 600px at 60% 60%, rgba(53,230,255,.12), transparent 60%),linear-gradient(180deg, rgba(7,8,21,1), rgba(7,8,21,.96));
  overflow-x:hidden;
}
body::before{
  content:""; position:fixed; inset:0;
  background:
    radial-gradient(900px 600px at 50% 30%, rgba(255,61,242,.12), transparent 60%),
    radial-gradient(900px 600px at 60% 60%, rgba(53,230,255,.14), transparent 60%),
    linear-gradient(180deg, rgba(7,8,21,.55), rgba(7,8,21,.78));
  pointer-events:none;
}
body::after{
  content:""; position:fixed; inset:0;
  background: repeating-linear-gradient(0deg, rgba(255,255,255,.035) 0px, rgba(255,255,255,.035) 1px, transparent 2px, transparent 6px);
  mix-blend-mode: overlay; opacity:.18; pointer-events:none;
}
.wrap{max-width: 1040px; margin:0 auto; padding: 26px 18px 60px; position:relative; z-index:1;}
.topbar{display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;}
.back{display:flex; align-items:center; gap:8px; color:var(--muted); text-decoration:none; letter-spacing:.2em; font-size:12px; opacity:.85}
.datepill{padding:6px 12px;border-radius:999px;border:1px solid rgba(53,230,255,.35);background: rgba(8,10,20,.45);box-shadow: 0 0 22px rgba(53,230,255,.12);letter-spacing:.2em;font-size:12px;text-transform:uppercase;color:rgba(234,241,255,.85);}
.hero{text-align:center; padding: 26px 0 14px;}
.hero h1{margin:0;font-size:64px;letter-spacing:.06em;line-height:.92;text-transform:uppercase;text-shadow: 0 0 30px rgba(255,61,242,.25), 0 0 60px rgba(255,61,242,.22);}

.sub{
  text-align:center;
}
.sub .zh-title{
  font-size:14px;
  letter-spacing:.18em;
  margin-bottom:6px;
}
.sub .en-title{
  font-size:12px;
  letter-spacing:.28em;
  text-transform:uppercase;
  color: rgba(53,230,255,.9);
}


/* Stage title enhancement */
.hero{
  padding: 18px 0 8px;
}
.hero h1{
  font-size:72px;
}
.sub{
  margin-top:14px;
}
.stage-divider{
  width:160px;
  height:2px;
  margin:14px auto 10px;
  background: linear-gradient(90deg, transparent, rgba(53,230,255,.9), transparent);
  box-shadow: 0 0 18px rgba(53,230,255,.45);
}

.hero .sub{margin-top:10px;letter-spacing:.35em;font-size:12px;color:rgba(53,230,255,.88);text-transform:uppercase;}
.searchRow{display:flex; justify-content:center; margin: 12px 0 4px;}
.search{width:min(780px, 92vw);display:flex; align-items:center; gap:10px;padding: 12px 14px;border-radius: 999px;background: rgba(8,10,20,.62);border: 1px solid rgba(255,255,255,.10);box-shadow: 0 0 28px rgba(0,0,0,.35), 0 0 40px rgba(53,230,255,.08);}
.search input{width:100%;background:transparent;border:0;outline:none;color:var(--text);font-size:16px;letter-spacing:.06em;text-transform:uppercase;}

.hint{margin: 10px auto 0; text-align:center; color: rgba(234,241,255,.78); font-size: 12px; letter-spacing:.08em;}
.hint .en{display:inline-block; margin-top:6px; color: rgba(53,230,255,.85); letter-spacing:.14em; text-transform:uppercase; font-size: 11px;}

.resultPill{margin: 10px auto 0;width: fit-content;padding: 7px 12px;border-radius: 999px;background: rgba(255,61,242,.18);border: 1px solid rgba(255,61,242,.42);box-shadow: 0 0 26px rgba(255,61,242,.12);color: rgba(234,241,255,.92);font-size: 12px;letter-spacing:.12em;display:none;}
.mapWrap{display:flex; justify-content:center; margin-top: 6px;}
.map{position:relative;width:min(820px, 96vw);aspect-ratio:1/1;border-radius:24px;background: rgba(8,10,20,.12);}
.map::before{content:"";position:absolute;inset:0;background: radial-gradient(circle at 50% 68%, rgba(53,230,255,.12), transparent 58%);border-radius:24px;pointer-events:none;}
.stage{position:absolute;top:46%;left:50%;transform: translate(-50%, -50%);width:220px;height:78px;display:flex;align-items:center;justify-content:center;border-radius:16px;background: rgba(8,10,20,.66);border:2px solid rgba(53,230,255,.55);box-shadow: 0 0 22px rgba(53,230,255,.25), inset 0 0 22px rgba(53,230,255,.08);color: rgba(53,230,255,.95);letter-spacing:.24em;font-weight:900;text-transform:uppercase;}
.line{position:absolute;width:2px;background:none;border-left:2px dashed rgba(53,230,255,.35);opacity:.85;}
.node{position:absolute;width:128px;height:128px;border-radius:999px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;user-select:none;background: rgba(8,10,20,.62);transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;}
.node:hover{transform: translateY(-2px) scale(1.02);}
.node .t{font-size:12px;letter-spacing:.18em;opacity:.92;text-transform:uppercase;}
.node .no{font-size:34px;font-weight:950;letter-spacing:.06em;}
.node .tag{font-size:11px;letter-spacing:.18em;opacity:.88;text-transform:uppercase;}
.node.cyan{border:2px solid rgba(53,230,255,.68);box-shadow: 0 0 18px rgba(53,230,255,.24);}
.node.magenta{border:2px solid rgba(255,61,242,.70);box-shadow: 0 0 18px rgba(255,61,242,.20);}
.node.yellow{border:3px solid rgba(255,227,79,.78);box-shadow: 0 0 22px rgba(255,227,79,.20);}
.node.yellow .t,.node.yellow .tag{color: rgba(255,227,79,.95);}
.highlight{animation: pulse 1.05s ease-in-out 0s 3, floaty .65s ease-in-out 0s 4;box-shadow: 0 0 0 8px rgba(53,230,255,.10), 0 0 30px rgba(53,230,255,.32) !important;}
@keyframes pulse{0%{filter:brightness(1)}50%{filter:brightness(1.25)}100%{filter:brightness(1)}}
@keyframes floaty{0%{transform: translateY(0) scale(1)}50%{transform: translateY(-5px) scale(1.03)}100%{transform: translateY(0) scale(1)}}
.modalMask{position:fixed;inset:0;background: rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:50;padding:22px;}
.modal{width:min(860px, 96vw);border-radius:18px;background: rgba(18, 10, 40, .82);border:2px solid rgba(53,230,255,.65);box-shadow: 0 0 28px rgba(53,230,255,.22), 0 0 50px rgba(255,61,242,.10);overflow:hidden;backdrop-filter: blur(8px);}
.modalHead{padding:16px 18px;display:flex;align-items:center;justify-content:space-between;gap:14px;border-bottom:1px solid rgba(255,255,255,.10);}
.modalTitle{font-size:34px;font-weight:950;letter-spacing:.08em;text-transform:uppercase;color: rgba(255,227,79,.95);text-shadow: 0 0 18px rgba(255,227,79,.18);}
.close{width:42px;height:42px;border-radius:12px;border:1px solid rgba(53,230,255,.55);background: rgba(8,10,20,.45);color: rgba(53,230,255,.95);cursor:pointer;font-size:22px;line-height:40px;text-align:center;box-shadow: 0 0 20px rgba(53,230,255,.16);}
.modalBody{padding:18px 22px 20px;}
.grid2{display:grid;grid-template-columns: 1fr 1fr;gap:10px 36px;}
@media (max-width:720px){.grid2{grid-template-columns:1fr;}.hero h1{font-size:44px}}

.row.gs{border-color: rgba(53,230,255,.28);}
.row.tfl{border-color: rgba(255,61,242,.28);}
.row.gs .bar{background: linear-gradient(180deg, rgba(53,230,255,1), rgba(53,230,255,.55)); box-shadow: 0 0 18px rgba(53,230,255,.22);}
.row.tfl .bar{background: linear-gradient(180deg, rgba(255,61,242,1), rgba(255,61,242,.55)); box-shadow: 0 0 18px rgba(255,61,242,.20);}
.row.gs .meta{color: rgba(53,230,255,.9);}
.row.tfl .meta{color: rgba(255,61,242,.9);}

.row{display:flex;align-items:center;gap:12px;padding:10px 10px;border-radius:14px;background: rgba(0,0,0,.18);border:1px solid rgba(255,255,255,.08);}
.bar{width:3px;height:22px;background: linear-gradient(180deg, var(--magenta), var(--cyan));border-radius:999px;box-shadow: 0 0 18px rgba(255,61,242,.20);}
.name{font-weight:900;letter-spacing:.04em;font-size:20px;}
.zh{opacity:.92;font-weight:800}
.meta{margin-left:auto;font-size:12px;color:var(--muted);letter-spacing:.06em}

.marker{
  position:absolute;
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(53,230,255,.16);
  border: 1px solid rgba(53,230,255,.55);
  box-shadow: 0 0 26px rgba(53,230,255,.14);
  color: rgba(234,241,255,.95);
  font-size: 11px;
  letter-spacing:.18em;
  text-transform: uppercase;
  pointer-events:none;
  transform: translate(10px, -10px);
  display:none;
  white-space:nowrap;
}
.marker::before{
  content:"";
  position:absolute;
  left:-6px; top:50%;
  width:10px; height:10px;
  background: rgba(53,230,255,.35);
  border: 1px solid rgba(53,230,255,.55);
  transform: translateY(-50%) rotate(45deg);
  border-radius: 2px;
}
.resultsList{
  width:min(780px, 92vw);
  margin: 10px auto 0;
  display:none;
  gap:10px;
  flex-wrap:wrap;
  justify-content:center;
}
.resultsList button{
  cursor:pointer;
  border: 1px solid rgba(255,255,255,.12);
  background: rgba(8,10,20,.55);
  color: rgba(234,241,255,.92);
  padding: 8px 10px;
  border-radius: 999px;
  letter-spacing:.08em;
  font-size: 12px;
  box-shadow: 0 0 18px rgba(0,0,0,.25);
}
.resultsList button:hover{
  border-color: rgba(53,230,255,.45);
  box-shadow: 0 0 26px rgba(53,230,255,.10);
}

</style>
</head>
<body>
<div class="wrap">
  <div class="topbar">
    <a class="back" href="javascript:void(0)" onclick="history.back()"><span style="font-size:18px; transform: translateY(-1px);">←</span> BACK</a>
    <div class="datepill">FEBRUARY 06, 2026</div>
    <div style="width:68px"></div>
  </div>

  <div class="hero">
    <h1>DISCO<br/>FEVER</h1>
    <div class="stage-divider"></div>
    <div class="sub">尾牙座位圖&nbsp;&nbsp;|&nbsp;&nbsp;GS × TFL Year-End Party Seating Plan</div>
  </div>

  <div class="searchRow">
    <div class="search" role="search" aria-label="search">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
        <path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="rgba(53,230,255,.95)" stroke-width="2"/>
        <path d="M16.5 16.5 21 21" stroke="rgba(53,230,255,.95)" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <input id="q" placeholder="ENTER YOUR ENGLISH NAME..." autocomplete="off" />
    </div>
  </div>
  <div class="resultPill" id="resultPill"></div>
  <div class="hint" id="hint">輸入英文名字搜尋<br/><span class="en">Search by English name</span></div>
    <div class="resultsList" id="resultsList"></div>


  <div class="mapWrap">
    <div class="map" id="map">
      <div class="stage">STAGE</div>
      <div class="marker" id="marker">YOU ARE HERE</div>

      <div class="line" style="left:50%; top:50%; height:160px; transform:translate(-1px,20px) rotate(0deg);"></div>
      <div class="line" style="left:50%; top:50%; height:210px; transform:translate(-1px,20px) rotate(-36deg);"></div>
      <div class="line" style="left:50%; top:50%; height:210px; transform:translate(-1px,20px) rotate(36deg);"></div>
      <div class="line" style="left:50%; top:50%; height:260px; transform:translate(-1px,20px) rotate(-144deg);"></div>
      <div class="line" style="left:50%; top:50%; height:260px; transform:translate(-1px,20px) rotate(144deg);"></div>

      <div class="node yellow" data-table="1" style="left:50%; top:63%; transform:translate(-50%,-50%); width:150px; height:150px;">
        <div class="t">TABLE</div><div class="no">01</div><div class="tag">MAIN</div>
      </div>
      <div class="node magenta" data-table="2" style="left:22%; top:48%; transform:translate(-50%,-50%);">
        <div class="t">TABLE</div><div class="no">02</div><div class="tag">ALPHA</div>
      </div>
      <div class="node cyan" data-table="3" style="left:78%; top:48%; transform:translate(-50%,-50%);">
        <div class="t">TABLE</div><div class="no">03</div><div class="tag">BETA</div>
      </div>
      <div class="node cyan" data-table="4" style="left:28%; top:80%; transform:translate(-50%,-50%); width:120px; height:120px;">
        <div class="t">TABLE</div><div class="no">04</div><div class="tag">GAMMA</div>
      </div>
      <div class="node cyan" data-table="5" style="left:72%; top:80%; transform:translate(-50%,-50%); width:120px; height:120px;">
        <div class="t">TABLE</div><div class="no">05</div><div class="tag">DELTA</div>
      </div>
    </div>
  </div>
</div>

<div class="modalMask" id="mask">
  <div class="modal">
    <div class="modalHead">
      <div class="modalTitle" id="modalTitle">TABLE 01 - MAIN TABLE</div>
      <div class="close" id="closeBtn">×</div>
    </div>
    <div class="modalBody">
      <div class="grid2" id="modalList"></div>
    </div>
  </div>
</div>

<script>
const DATA = [{"tableNo": 1, "people": [{"en": "Andy", "zh": "歐昱成", "unit": "GS", "dept": "總經理室", "loc": "臺南", "title": "總經理"}, {"en": "Emily", "zh": "梁芸溱", "unit": "GS", "dept": "行政處", "loc": "臺南", "title": "處長"}, {"en": "Gary", "zh": "歐昱村", "unit": "GS", "dept": "業務處／留學部／業務組", "loc": "高雄", "title": "辦公室經理"}, {"en": "William", "zh": "馬偉宸", "unit": "GS", "dept": "業務處／留學部", "loc": "臺南", "title": "助理總監"}, {"en": "Rebecca", "zh": "潘瀅琪", "unit": "GS", "dept": "主持人", "loc": "臺南", "title": "主持人"}, {"en": "Almond", "zh": "蒙志成", "unit": "TFL", "dept": "", "loc": "臺南", "title": "首席教育顧問"}, {"en": "Fanita", "zh": "黃纚文", "unit": "TFL", "dept": "教務處", "loc": "臺南", "title": "主任"}, {"en": "Tadashi", "zh": "吳忠恩", "unit": "TFL", "dept": "學務處", "loc": "臺南", "title": "主任"}, {"en": "Alan", "zh": "賴義方", "unit": "TFL", "dept": "貴賓", "loc": "臺南", "title": "貴賓"}, {"en": "Ray", "zh": "許朝翔", "unit": "TFL", "dept": "貴賓", "loc": "臺南", "title": "貴賓"}]}, {"tableNo": 2, "people": [{"en": "Claire", "zh": "黃子瑜", "unit": "GS", "dept": "行政處", "loc": "臺南", "title": "處長"}, {"en": "Ann", "zh": "周真安", "unit": "GS", "dept": "行政處／數位發展部", "loc": "高雄", "title": "經理"}, {"en": "Bruce", "zh": "陳柏宇", "unit": "GS", "dept": "行政處／數位發展部", "loc": "臺南", "title": "資訊專案管理師"}, {"en": "Kessy", "zh": "吳秀雯", "unit": "GS", "dept": "行政處／財務部", "loc": "臺南", "title": "財務專員"}, {"en": "Jessie", "zh": "蔡佳蓉", "unit": "GS", "dept": "行政處／人力資源部", "loc": "臺南", "title": "人力資深專員"}, {"en": "Amanda", "zh": "周沂萱", "unit": "GS", "dept": "行銷部", "loc": "臺南", "title": "影音企劃專員"}, {"en": "Annie", "zh": "陳誼安", "unit": "TFL", "dept": "行政處", "loc": "臺南", "title": "主任"}, {"en": "Lilian", "zh": "徐立珩", "unit": "TFL", "dept": "推廣處", "loc": "臺南", "title": "主任"}, {"en": "Yoann", "zh": "吳釉安", "unit": "TFL", "dept": "推廣處", "loc": "臺南", "title": "組員"}, {"en": "Jessy", "zh": "杜沛穎", "unit": "TFL", "dept": "推廣處", "loc": "臺南", "title": "組員"}]}, {"tableNo": 3, "people": [{"en": "Jessica", "zh": "葉晏華", "unit": "GS", "dept": "行銷部", "loc": "臺南", "title": "經理"}, {"en": "Maisie", "zh": "江虹臻", "unit": "GS", "dept": "行銷部", "loc": "臺南", "title": "組長"}, {"en": "Paula", "zh": "林庭卉", "unit": "GS", "dept": "業務處／B2B業務部", "loc": "臺南", "title": "助理總監"}, {"en": "Chloe", "zh": "戴慧珊", "unit": "GS", "dept": "業務處／喬百事", "loc": "臺南", "title": "助理總監"}, {"en": "Tommy", "zh": "賴昱誠", "unit": "GS", "dept": "業務處／留學部業務組", "loc": "臺北", "title": "資深顧問"}, {"en": "Vicky", "zh": "張琪維", "unit": "GS", "dept": "業務處／留學部業務組", "loc": "臺南", "title": "資深顧問"}, {"en": "Shiny", "zh": "李家鳴", "unit": "TFL", "dept": "學務處", "loc": "臺南", "title": "組長"}, {"en": "Marco", "zh": "夏馬克", "unit": "TFL", "dept": "教務處", "loc": "臺南", "title": "組長"}, {"en": "Frank", "zh": "蔡冠暉", "unit": "TFL", "dept": "學務處", "loc": "臺南", "title": "組長"}, {"en": "Tony", "zh": "施柏仰", "unit": "TFL", "dept": "教務處", "loc": "臺南", "title": "導師"}]}, {"tableNo": 4, "people": [{"en": "Mona", "zh": "謝孟庭", "unit": "GS", "dept": "業務處／留學部業務組", "loc": "臺北", "title": "資深顧問"}, {"en": "Rex", "zh": "郭駿仁", "unit": "GS", "dept": "業務處／留學部業務組", "loc": "臺南", "title": "資深顧問"}, {"en": "Miya", "zh": "林旻儀", "unit": "GS", "dept": "業務處／留學部後勤組", "loc": "臺南", "title": "後勤專員"}, {"en": "Shirley", "zh": "蔡亞汝", "unit": "GS", "dept": "業務處／留學部後勤組", "loc": "臺南", "title": "後勤專員"}, {"en": "Muno", "zh": "傅祉瑜", "unit": "GS", "dept": "業務處／喬百事", "loc": "臺南", "title": "業務專員"}, {"en": "Sunny", "zh": "張詠晴", "unit": "GS", "dept": "業務處／喬百事", "loc": "臺南", "title": "業務專員"}, {"en": "Claire", "zh": "常睿耘", "unit": "TFL", "dept": "教務處", "loc": "臺南", "title": "組員"}, {"en": "Ciaran", "zh": "徐凱倫", "unit": "TFL", "dept": "教務處", "loc": "臺南", "title": "教師"}, {"en": "Sam", "zh": "羅健銨", "unit": "TFL", "dept": "教務處", "loc": "臺南", "title": "教師"}, {"en": "Thomas", "zh": "黃昱翔", "unit": "TFL", "dept": "教務處", "loc": "臺南", "title": "教師"}]}, {"tableNo": 5, "people": [{"en": "Yuna", "zh": "潘韻竹", "unit": "GS", "dept": "業務處／留學部業務組", "loc": "臺中", "title": "資深顧問"}, {"en": "Sue", "zh": "蘇品綺", "unit": "GS", "dept": "業務處／留學部業務組", "loc": "臺南", "title": "資深顧問"}, {"en": "Ben", "zh": "李睿峻", "unit": "GS", "dept": "業務處／B2B業務部", "loc": "臺南", "title": "專案專員"}, {"en": "Teresa", "zh": "牟洹", "unit": "GS", "dept": "總經理室", "loc": "臺南", "title": "行政秘書"}, {"en": "Sonia", "zh": "黃雪華", "unit": "GS", "dept": "業務處／留學部後勤組", "loc": "臺南", "title": "後勤專員"}, {"en": "Wendy", "zh": "蘇稚微", "unit": "GS", "dept": "業務處／留學部後勤組", "loc": "臺南", "title": "專案專員"}, {"en": "Nick", "zh": "林預忠", "unit": "TFL", "dept": "行政處", "loc": "臺南", "title": "人資專員"}, {"en": "Helen", "zh": "陳慧如", "unit": "TFL", "dept": "行政處", "loc": "臺南", "title": "會計專員"}, {"en": "Alexia", "zh": "吳怡慧", "unit": "TFL", "dept": "教務處", "loc": "臺南", "title": "組員"}, {"en": "Sean", "zh": "張信翔", "unit": "TFL", "dept": "教務處", "loc": "臺南", "title": "導師"}]}];
const byNo = new Map(DATA.map(t => [Number(t.tableNo), t]));
const TAGS = new Map([[1,"MAIN TABLE"],[2,"ALPHA"],[3,"BETA"],[4,"GAMMA"],[5,"DELTA"]]);

const mask = document.getElementById("mask");
const closeBtn = document.getElementById("closeBtn");
const modalTitle = document.getElementById("modalTitle");
const modalList = document.getElementById("modalList");
const q = document.getElementById("q");
const resultPill = document.getElementById("resultPill");
const resultsList = document.getElementById("resultsList");
const marker = document.getElementById("marker");

function esc(s){ return String(s ?? "").replace(/[&<>"']/g, m => ({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"}[m])); }

function openTable(no){
  const t = byNo.get(Number(no));
  if(!t){ alert("找不到該桌資料（table " + no + "）"); return; }
  const label = TAGS.get(Number(no)) || "";
  modalTitle.textContent = `TABLE ${String(no).padStart(2,"0")} - ${label}`;

  const people = t.people.slice();
  modalList.innerHTML = people.map(p => {
    const unit = (p.unit || "").trim().toUpperCase();
    const unitClass = unit === "TFL" ? "tfl" : "gs";
    const meta = unit;
    return `
      <div class="row ${unitClass}">
        <div class="bar"></div>
        <div class="name">${esc(p.en)} <span class="zh">${esc(p.zh || "")}</span></div>
        <div class="meta">${esc(meta)}</div>
      </div>
    `;
  }).join("");

  mask.style.display = "flex";
}

function close(){ mask.style.display = "none"; }
closeBtn.addEventListener("click", close);
mask.addEventListener("click", (e)=>{ if(e.target === mask) close(); });
window.addEventListener("keydown", (e)=>{ if(e.key === "Escape") close(); });

document.querySelectorAll(".node").forEach(node => {
  node.addEventListener("click", ()=> openTable(node.dataset.table));
});

function clearHighlight(){ document.querySelectorAll(".node").forEach(n => n.classList.remove("highlight")); }
function highlight(no){
  const el = document.querySelector(`.node[data-table="${no}"]`);
  if(!el) return;
  clearHighlight();
  el.classList.add("highlight");
  el.scrollIntoView({behavior:"smooth", block:"center", inline:"center"});
  setTimeout(()=> el.classList.remove("highlight"), 3200);
}

function placeMarkerOnTable(no, text="YOU ARE HERE"){
  const el = document.querySelector(`.node[data-table="${no}"]`);
  const map = document.getElementById("map");
  if(!el || !map) return;

  const er = el.getBoundingClientRect();
  const mr = map.getBoundingClientRect();
  const x = (er.left - mr.left) + er.width/2;
  const y = (er.top - mr.top) + er.height/2;

  marker.textContent = text;
  marker.style.left = `${x}px`;
  marker.style.top = `${y}px`;
  marker.style.display = "block";
}

function hideMarker(){
  marker.style.display = "none";
}

function clearResultsList(){
  resultsList.innerHTML = "";
  resultsList.style.display = "none";
}

function search(){
  const needle = (q.value || "").trim().toLowerCase();

  if(!needle){
    resultPill.style.display = "none";
    clearHighlight();
    hideMarker();
    clearResultsList();
    return;
  }

  const hits = [];
  for(const t of DATA){
    for(const p of t.people){
      if(String(p.en || "").toLowerCase().includes(needle)) hits.push({tableNo: t.tableNo, person: p});
    }
  }

  if(hits.length === 0){
    resultPill.textContent = `NOT FOUND: ${q.value}`;
    resultPill.style.display = "block";
    clearHighlight();
    hideMarker();
    clearResultsList();
    return;
  }

  // 1) Always highlight the first match (fast feedback while typing)
  const first = hits[0];
  const no = Number(first.tableNo);
  highlight(no);
  placeMarkerOnTable(no, "HERE");

  // 2) Single match: show pill only
  if(hits.length === 1){
    clearResultsList();
    resultPill.textContent = `FOUND: ${first.person.en}${first.person.zh ? " ("+first.person.zh+")" : ""}  →  TABLE ${String(no).padStart(2,"0")}`;
    resultPill.style.display = "block";
    return;
  }

  // 3) Multiple matches (e.g., two Claires): show selectable chips
  resultPill.textContent = `MULTIPLE MATCHES: ${q.value}  (${hits.length})  —  SELECT ONE`;
  resultPill.style.display = "block";

  resultsList.innerHTML = hits.map((h, idx) => {
    const tno = Number(h.tableNo);
    const label = `${h.person.en}${h.person.zh ? " ("+h.person.zh+")" : ""} · ${h.person.unit ? h.person.unit : ""} · TABLE ${String(tno).padStart(2,"0")}`;
    return `<button type="button" data-t="${tno}" data-i="${idx}">${label}</button>`;
  }).join("");
  resultsList.style.display = "flex";

  resultsList.querySelectorAll("button").forEach(btn => {
    btn.addEventListener("click", () => {
      const tno = Number(btn.dataset.t);
      highlight(tno);
      placeMarkerOnTable(tno, "YOU ARE HERE");
    });
  });
}

let tmr=null;
q.addEventListener("input", ()=>{ clearTimeout(tmr); tmr=setTimeout(search, 180); });
</script>
</body>
</html>
